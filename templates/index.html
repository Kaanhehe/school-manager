<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>School Manager</title>
    <style>
        body {
            color : white;
            background-color: #121212;
        }
        .timetable, .homework{
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            margin: 15px 0;
        }
        th, td {
            border: 1px solid #424242;
            padding: 8px;
            text-align: left;
        }

        th {
            background-color: #4CAF50;
        }

        tr:nth-child(even) {
            background-color: #333;
        }

        .special-font {
            font-family: Arial, sans-serif;
        }

        .navbar {
            background-color: #333;
            overflow: hidden;
        }

        .navbar a {
            float: left;
            color: white;
            text-align: center;
            padding: 14px 16px;
            text-decoration: none;
            font-size: 17px;
        }

        .navbar a:hover {
            background-color: #ddd;
            color: black;
        }

        .navbar a.active {
            background-color: #4CAF50;
            color: white;
        }

        .navbar a.active:hover {
            background-color: #4CAF50;
        }

        .newhwform {
            display: none;
        }

        .newhwform {
        display: none;
        position: fixed;
        z-index: 1;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0,0,0,0.4);
        }

        .newhwform-content {
        background-color: #fefefe;
        margin: 15% auto;
        padding: 20px;
        border: 1px solid #888;
        width: 80%;
        }

        .closehwform {
        color: #aaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
        }

        .closehwform:hover,
        .closehwform:focus {
        color: black;
        text-decoration: none;
        cursor: pointer;
        }

        #homework {
            display: none;
        }

        .class-option {
            font-size: 20px;
            font-weight: bold;
            color: #333;
        }
        .class-option:hover {
            background-color: transparent; /* Change the color of the class-option when hovered, but doesnt work somehow */
        }

        label {
            color: #333;
        }

        #class, #homework_name, #work_amount, #homeworksub{
            width: 100px;
            height: 30px;
            margin: 10px;
        }
    </style>
    <script>
        function sortTable() {
            var table, rows, switching, i, x, y, shouldSwitch;
            table = document.getElementById("timetable");
            switching = true;
            while (switching) {
                switching = false;
                rows = table.getElementsByTagName("tr");
                for (i = 1; i < (rows.length - 1); i++) {
                    shouldSwitch = false;
                    x = rows[i].getElementsByTagName("td")[0];
                    y = rows[i + 1].getElementsByTagName("td")[0];
                    if (parseInt(x.innerHTML) > parseInt(y.innerHTML)) {
                        shouldSwitch = true;
                        break;
                    }
                }
                if (shouldSwitch) {
                    rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
                    switching = true;
                }
            }
        }
        function changeActiveClass(event) {
            var navbar = document.getElementsByClassName("navbar")[0];
            var current = navbar.getElementsByClassName("active");
            current[0].classList.remove("active");
            event.target.className += " active";
            if (event.target.id === "timetable-link") {
                document.getElementById("timetable").style.display = "block";
            } else {
                document.getElementById("timetable").style.display = "none";
            }
            if (event.target.id === "homework-link") {
                document.getElementById("homework").style.display = "block";
                color_classes();
            } else {
                document.getElementById("homework").style.display = "none";
            }
        }

        function displayhwform() {
            var form = document.getElementsByClassName("newhwform")[0];
            if (form.style.display === "none" || form.style.display === "") {
                form.style.display = "block";
                sortClassesByColor();
            } else {
                form.style.display = "none";
            }
        }

        function closehwform() {
            var form = document.getElementsByClassName("newhwform")[0];
            form.style.display = "none";
        }

        function get_class_color (class_name) {
            var colors = {
                    'Mathematik': '#6495ED',
                    'Deutsch': '#FF8080',
                    'Englisch': '#EEC759',
                    'Biologie': '#99BC85',
                    'Geschichte': '#F57D1F',
                    'Geographie': '#808080',
                    'Physik': '#7BD3EA',
                    'Chemie': '#FF00FF',
                    'Informatik': '#A52A2A',
                    'Sport': '#AAD7D9',
                    'Musik': '#00FFFF',
                    'Kunst': '#E493B3',
                    'Ethik': '#E5E1DA',
                    'Religion': '#FBF9F1',
                    'PoWi': '#FF90BC',
                };
            return colors[class_name];
        }

        function rgbToHsl(rgb) {
            var r = parseInt(rgb.slice(1, 3), 16) / 255;
            var g = parseInt(rgb.slice(3, 5), 16) / 255;
            var b = parseInt(rgb.slice(5, 7), 16) / 255;

            var max = Math.max(r, g, b), min = Math.min(r, g, b);
            var h, s, l = (max + min) / 2;

            if(max == min){
                h = s = 0;
            } else {
                var d = max - min;
                s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
                switch(max){
                    case r: h = (g - b) / d + (g < b ? 6 : 0); break;
                    case g: h = (b - r) / d + 2; break;
                    case b: h = (r - g) / d + 4; break;
                }
                h /= 6;
            }

            return [h, s, l];
        }

        function sortClassesByColor() {
            var selectElement = document.getElementById('class');
            var classes = Array.from(selectElement.options);

            classes.sort(function(a, b) {
                var hslA = rgbToHsl(get_class_color(a.text));
                var hslB = rgbToHsl(get_class_color(b.text));
                return hslA[0] - hslB[0];
            });

            classes.forEach(function(option) {
                selectElement.appendChild(option);
            });
        }

        function color_classes(){
            var elements = document.getElementsByClassName('class-option');
            for (var i = 0; i < elements.length; i++) {
                var classElement = elements[i];
                var className = classElement.textContent || classElement.innerText;
                classElement.style.backgroundColor = get_class_color(className);
            }
        };
    </script>
</head>
<body onload="sortTable()">
    <div class="navbar">
        <a id="timetable-link" class="active" onclick="changeActiveClass(event)" href="#">Timetable</a>
        <a id="homework-link" onclick="changeActiveClass(event)" href="#">Homework</a>
    </div>
    <div id="timetable">
        <h1>Stundenplan</h1>
        <table class="timetable">
            <thead>
                <tr>
                    <th>Nummer</th>
                    <th>Zeit</th>
                    <th>Montag</th>
                    <th>Dienstag</th>
                    <th>Mittwoch</th>
                    <th>Donnerstag</th>
                    <th>Freitag</th>
                </tr>
            </thead>
            <tbody>
                {% for group in timetable_data %}
                    <tr>
                        {% set class_day, class_num, class_time, class_name, class_loc, class_tea = group[0][:6] %}
                        <td>{{ class_num }}</td>
                        <td>{{ class_time }}</td>
                        {% for class_data in group %}
                            {% set class_day, class_num, class_time, class_name, class_loc, class_tea = class_data[:6] %}
                            {% set day_columns = {'Montag': 2, 'Dienstag': 3, 'Mittwoch': 4, 'Donnerstag': 5, 'Freitag': 6} %}
                            {% if class_day in day_columns %}
                                <td>{{ class_name ~ ' ' ~ class_loc ~ ' ' ~ class_tea }}</td>
                            {% endif %}
                        {% endfor %}
                    </tr>
                {% endfor %}
                <tr>
                    <td>7</td>
                    <td>13:00 - 13:45</td>
                    <td colspan="6" style="text-align: center; font-size: 20px; font-weight: bold;" class="special-font">Mittagspause</td>
                </tr>
            </tbody>
        </table>
    </div>
    <div id="homework">
        <h1>Hausaufgaben</h1>

        <button id="newhw" onclick="displayhwform()">Neue Hausaufgabe</button>

        <div id="popup-newhw" class="newhwform">
            <div class="newhwform-content">
                <span id="closehwformButton" class="closehwform" onclick="closehwform()">&times;</span>
                
                <form action="/homework" method="post">
                    <label for="class">Fach</label>
                    <select id="class" name="class">
                        {% for class in classes_data %}
                            <option value="{{ class }}" class="class-option">{{ class }}</option>
                        {% endfor %}
                    </select>

                    <label for="homework_name">Aufgabe</label>
                    <input type="text" id="homework_name" name="homework_name" placeholder="S.13/5a">

                    <label for="work_amount">Arbeitsaufwand</label>
                    <select id="work_amount" name="work_amount">
                        <option value="easy">Easy</option>
                        <option value="normal">Normal</option>
                        <option value="hard">Hard</option>
                    </select>

                    <input id="homeworksub" type="submit" value="Submit">
                </form>
            </div>
        </div>

        <table class="homework">
            <thead>
                <tr>
                    <th>Fach</th>
                    <th>Aufgabe</th>
                    <th>Abgabedatum</th>
                </tr>
            </thead>
            <tbody>
                {% for homework in homework_data %}
                    <tr>
                        <td>{{ homework[0] }}</td>
                        <td>{{ homework[1] }}</td>
                        <td>{{ homework[2] }}</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</body>
</html>
